{"name":"breadcrumbsActorConfig","type":"script","scope":"global","author":"enbSZFWzu5dUH8Ji","img":"icons/svg/dice-target.svg","command":"const currentScene = game.scenes.current\n\nconst loadoutsTileDialog = new Dialog({\n    title: \"Breadcrumbs\", \n    content:`\n    <script>\n        async function fileBrowser() {\n            const path = '` + game.settings.get(\"breadcrumbs\", \"breadcrumbs-default-image\") + `';\n            new FilePicker({\n                type: 'image',\n                current: path,\n                callback: imagePath => {\n                    document.getElementById(\"breadcrumbsImagePreview\").src = imagePath;\n                },\n            }).browse();\n    }\n    </script>\n    <script type=\"text/javascript\">\n        function limitTrailLength(obj){\n            if (obj.value.length > 2){\n                obj.value = obj.value.slice(0,2); \n            }\n        }\n    </script>\n    <form class=\"form-horizontal\">\n    <fieldset>\n    \n    <!-- Form Name -->\n    <legend>Actor & Token Controls</legend>\n\n    <!-- Boolean input-->\n    <div class=\"form-group\">\n      <label class=\"col-md-4 control-label\" for=\"enableBreadcrumbs\">Enable Breadcrumbs</label>  \n      <div class=\"col-md-4\">\n      <input id=\"enableBreadcrumbs\" name=\"enableBreadcrumbs\" type=\"checkbox\" checked></input>\n      </div>\n    </div>\n    \n    <div class=\"form-group\">\n      <label class=\"col-md-4 control-label\" for=\"applyToActor\">Apply to Actor</label>  \n      <div class=\"col-md-4\">\n      <input id=\"applyToActor\" name=\"applyToActor\" type=\"checkbox\"></input>\n      </div>\n    </div>\n\n    </fieldset>\n    </form>\n\n    <form class=\"form-horizontal\">\n    <fieldset>\n    <legend>Image Properties</legend>\n    \n    <div class=\"form-group\">\n        <label>Breadcrumbs Image</label>\n        <button onclick=\"fileBrowser()\">\n            <img id=\"breadcrumbsImagePreview\" src=\"` + game.settings.get(\"breadcrumbs\", \"breadcrumbs-default-image\") + `\" style=\"width: 50px; height: 50px;\">\n        </button>\n    </div>\n\n    <div class=\"form-group\">\n        <label>Image Tint</label>\n        <input type=\"text\" name=\"imageTint\" is=\"colorpicker-input\" data-responsive-color>\n    </div>\n\n    <!-- Range input-->\n    <div class=\"form-group\">\n      <label class=\"col-md-4 control-label\" for=\"imageScale\">Image Scale</label>  \n      <div class=\"col-md-4\">\n      <input id=\"imageScale\" name=\"imageScale\" type=\"range\" min=\"0.1\" max=\"1\" step=\"0.1\" defaultValue=\"1\" value=\"1\" oninput=\"document.getElementById('rangeValLabel').innerHTML = this.value;\"></input>\n      <span class=\"help-block\">Scale: </span>\n      <em id=\"rangeValLabel\" style=\"font-style: normal;\">1</em>\n      </div>\n    </div>\n    </fieldset>\n    </form>\n    `,\n    buttons: {\n    cancel: {\n        icon: \"<i class='fas fa-check'></i>\",\n        label: `Cancel`,\n        callback: function(){ return; }  \n        },\n    apply: {\n        icon: \"<i class='fas fa-check'></i>\",\n        label: `Apply Changes` ,\n        callback: html => {setupBreadcrumbsActors(\n            html.find('[name=\"enableBreadcrumbs\"]').val(),\n            html.find('[name=\"applyToActor\"]').val(),\n            html.find(\"#breadcrumbsImagePreview\").attr(\"src\"),\n            html.find('[name=\"imageTint\"]').val(),\n            html.find('[name=\"imageScale\"]').val()\n        )}   \n        }\n      },\n    default: 'apply',\n}).render(true);\n\nasync function setupBreadcrumbsActors(enableBreadcrumbs, applyToActor, breadcrumbsImage, imageTint, imageScale) {\n    const enableBreadcrumbsCheckbox = document.getElementById('enableBreadcrumbs');\n    const setForSceneCheckbox = document.getElementById('setForScene');\n\n    if(applyToActor.checked) {\n        canvas.tokens.controlled.forEach(token => token.document.actor.update({\n            flags: {\n                breadcrumbs: {\n                    enabled: enableBreadcrumbsCheckbox.checked,\n                    style: {\n                        src: breadcrumbsImage,\n                        scale: imageScale,\n                        tint: imageTint.substring(0, 7)\n                    }\n                }\n            }\n        }));\n    } else {\n        canvas.tokens.controlled.forEach(token => token.document.update({\n            flags: {\n                breadcrumbs: {\n                    enabled: enableBreadcrumbsCheckbox.checked,\n                    style: {\n                        src: breadcrumbsImage,\n                        scale: imageScale,\n                        tint: imageTint\n                    }\n                }\n            }\n        }));\n    };\n};","flags":{"core":{"sourceId":"Macro.Yb0yBVtYHWEJqq8t"}},"_stats":{"systemId":"cyberpunk-red-core","systemVersion":"v0.87.6","coreVersion":"10.303","createdTime":1695415890206,"modifiedTime":1695490586853,"lastModifiedBy":"enbSZFWzu5dUH8Ji"},"folder":null,"sort":0,"ownership":{"default":0,"enbSZFWzu5dUH8Ji":3},"_id":"YXYKt5ZOsCToNbmg"}
{"name":"breadcrumbsSceneConfig","type":"script","scope":"global","author":"enbSZFWzu5dUH8Ji","img":"icons/svg/dice-target.svg","command":"const currentScene = game.scenes.current\n\nconst loadoutsTileDialog = new Dialog({\n    title: \"Breadcrumbs Scene Configuration\", \n    content:`\n    <script>\n        async function fileBrowser() {\n            const path = '` + game.settings.get(\"breadcrumbs\", \"breadcrumbs-default-image\") + `';\n            new FilePicker({\n                type: 'image',\n                current: path,\n                callback: imagePath => {\n                    document.getElementById(\"breadcrumbsImagePreview\").src = imagePath;\n                },\n            }).browse();\n    }\n    </script>\n    <script type=\"text/javascript\">\n        function limitTrailLength(obj){\n            if (obj.value.length > 2){\n                obj.value = obj.value.slice(0,2); \n            }\n        }\n    </script>\n    <form class=\"form-horizontal\">\n    <fieldset>\n    \n    <!-- Form Name -->\n    <legend>Scene Settings</legend>\n\n    <!-- Boolean input-->\n    <div class=\"form-group\">\n      <label class=\"col-md-4 control-label\" for=\"enableBreadcrumbs\">Enable Breadcrumbs</label>  \n      <div class=\"col-md-4\">\n      <input id=\"enableBreadcrumbs\" name=\"enableBreadcrumbs\" type=\"checkbox\" checked></input>\n      </div>\n    </div>\n\n    <div class=\"form-group\">\n      <label class=\"col-md-4 control-label\" for=\"overrideActors\">Override Actors</label>  \n      <div class=\"col-md-4\">\n      <input id=\"overrideActors\" name=\"overrideActors\" type=\"checkbox\"></input>\n      </div>\n    </div>\n\n    </fieldset>\n    </form>\n    \n    <form class=\"form-horizontal\">\n    <fieldset>\n    <legend>Image Properties</legend>\n\n    <div class=\"form-group\">\n        <label>Breadcrumbs Image</label>\n        <button onclick=\"fileBrowser()\">\n            <img id=\"breadcrumbsImagePreview\" src=\"` + game.settings.get(\"breadcrumbs\", \"breadcrumbs-default-image\") + `\" style=\"width: 50px; height: 50px;\">\n        </button>\n    </div>\n\n    <div class=\"form-group\">\n        <label>Image Tint</label>\n        <input type=\"text\" name=\"imageTint\" is=\"colorpicker-input\" data-responsive-color>\n    </div>\n\n    <!-- Range input-->\n    <div class=\"form-group\">\n      <label class=\"col-md-4 control-label\" for=\"breadcrumbsScale\">Breadcrumbs Scale</label>  \n      <div class=\"col-md-4\">\n      <input id=\"breadcrumbsScale\" name=\"breadcrumbsScale\" type=\"range\" min=\"0.1\" max=\"1\" step=\"0.1\" defaultValue=\"1\" value=\"1\" oninput=\"document.getElementById('rangeValLabel').innerHTML = this.value;\"></input>\n      <span class=\"help-block\">Scale: </span>\n      <em id=\"rangeValLabel\" style=\"font-style: normal;\">1</em>\n      </div>\n    </div>\n\n    </fieldset>\n    </form>\n\n    <form class=\"form-horizontal\">\n    <fieldset>\n    <legend>Trail Properties</legend>\n\n    <div class=\"form-group\">\n      <label for=\"trailLength\">Max Trail Length</label>\n      <input type=\"number\" id=\"trailLength\" name=\"trailLength\" value=\"` + game.settings.get(\"breadcrumbs\", \"breadcrumbs-default-trail-length\") + `\" min=\"0\" max=\"99\" oninput=\"limitTrailLength(this)\">\n    </div>\n\n    </fieldset>\n    </form>\n    `,\n      buttons: {\n        cancel: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: `Cancel`,\n            callback: function(){ return; }  \n            },\n        apply: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: `Apply Changes` ,\n            callback: html => {setupBreadcrumbsScene(\n                html.find('[name=\"enableBreadcrumbs\"]').val(),\n                html.find('[name=\"overrideActors\"]').val(),\n                html.find(\"#breadcrumbsImagePreview\").attr(\"src\"),\n                html.find('[name=\"imageTint\"]').val(),\n                html.find('[name=\"breadcrumbsScale\"]').val(),\n                html.find('[name=\"trailLength\"]').val()\n            )}   \n            }\n      },\n      default: 'apply',\n}).render(true);\n\nasync function setupBreadcrumbsScene(enableBreadcrumbs, overrideActors, breadcrumbsImage, imageTint, breadcrumbsScale, trailLength){\n    const enableBreadcrumbsCheckbox = document.getElementById('enableBreadcrumbs');\n    const overrideActorsCheckbox = document.getElementById('overrideActors');\n    currentScene.update({\n        \"flags.breadcrumbs\": {\n            enabled: enableBreadcrumbsCheckbox.checked,\n            override_actors: overrideActorsCheckbox.checked,\n            style: {\n                src: breadcrumbsImage,\n                scale: breadcrumbsScale,\n                tint: imageTint.substring(0, 7)\n            },\n            trails: {\n                length: {\n                    max: Number(trailLength)\n                }\n\n            }\n        }\n    });\n};","flags":{"core":{"sourceId":"Macro.16Vux8Qdq7rpmOLn"}},"_stats":{"systemId":"cyberpunk-red-core","systemVersion":"v0.87.6","coreVersion":"10.303","createdTime":1695319496688,"modifiedTime":1695490600756,"lastModifiedBy":"enbSZFWzu5dUH8Ji"},"folder":null,"sort":0,"ownership":{"default":0,"enbSZFWzu5dUH8Ji":3},"_id":"PcFpIFbVhGEvOqAe"}
